#source("ML10_Svd_UsageExampleFromMLReference.r")
library(MASS)

#a <- matrix(c(2,3,4,2,3,4,2,3,4), 3, 3)
a <- matrix(c(2,2,2,3,3,3,4,4,4), 3, 3)

a.svd <- svd(a)
u <- a.svd$u
v <- a.svd$v
d <- diag(a.svd$d)
a.computed <- u %*% d %*% t(v) 

a.svd$d
## [1] 3.46e+00 1.73e+00 1.73e+00 1.92e-16
ds <- diag(1/a.svd$d[1:3])

us <- as.matrix(u[, 1:3])
vs <- as.matrix(v[, 1:3])

(a.ginv <- vs %*% ds %*% t(us))
##         [,1]    [,2]    [,3]    [,4]    [,5]    [,6]    [,7]    [,8]
## [1,]  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833
## [2,]  0.2500  0.2500  0.2500 -0.0833 -0.0833 -0.0833 -0.0833 -0.0833
## [3,] -0.0833 -0.0833 -0.0833  0.2500  0.2500  0.2500 -0.0833 -0.0833
## [4,] -0.0833 -0.0833 -0.0833 -0.0833 -0.0833 -0.0833  0.2500  0.2500
##         [,9]
## [1,]  0.0833
## [2,] -0.0833
## [3,] -0.0833
## [4,]  0.2500
# using the function ginv defined in MASS
ginv(a)
##         [,1]    [,2]    [,3]    [,4]    [,5]    [,6]    [,7]    [,8]
## [1,]  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833  0.0833
## [2,]  0.2500  0.2500  0.2500 -0.0833 -0.0833 -0.0833 -0.0833 -0.0833
## [3,] -0.0833 -0.0833 -0.0833  0.2500  0.2500  0.2500 -0.0833 -0.0833
## [4,] -0.0833 -0.0833 -0.0833 -0.0833 -0.0833 -0.0833  0.2500  0.2500
##         [,9]
## [1,]  0.0833
## [2,] -0.0833
## [3,] -0.0833
## [4,]  0.2500